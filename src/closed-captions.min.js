"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Component=videojs.getComponent("Component"),closedCaptions=videojs.extend(Component,{constructor:function(o,e){var l,t,n,a=new sardius.libs.MenuMaker(o,{anOption:e});a.addClass("vjs-icon-captions");var i=navigator.userAgent,s=-1!==i.indexOf("iPad")||-1!==i.indexOf("Macintosh")&&"ontouchend"in document,r=-1!==i.indexOf("Safari")&&-1===i.indexOf("Chrome"),c=r&&(-1!==i.indexOf("iPhone")||-1!==i.indexOf("iPod")),d=c||r&&s;r=r&&c;var u=function(e){var t=l.options.labels,n=e.toLowerCase().replace(/[^a-z0-9]+/gi,"");return void 0!==t[n]&&(e=t[n]),e},p=a.addGroup({classes:"sp-captions",id:"sp-captions",title:"Closed Captions",minItems:1});d&&void 0!==o.playerManager.plugin.options.asset.assets.stream&&a.el_.classList.add("sp-captions-ios-live");var m=function(e){r||(n||((n=document.createElement("div")).className="sp-captions-display",n.innerHTML="",o.el_.appendChild(n)),t&&t.removeEventListener("cuechange",f,!0),e||!n?o.addRemoteTextTrack({kind:"captions",label:u(e.label),srclang:e.label.toLowerCase(),src:e.file,mode:"showing"},!0):n.innerHTML="")};function f(){if(!r&&(void 0!==n&&(n.innerHTML=""),0<this.activeCues_.length)){text=this.activeCues_[0].text,text=text.split(/\n/),o.textTrackDisplay.hide();var e=document.createElement("div");e.className="sp-captions-display-line",e.innerHTML="<div class='sp-captions-display-line-text'> "+text.join("<br />")+" </div>",n.appendChild(e)}}return o.on("settingsMenu-SourceHandler-change",function(e,t){a.hide(),l=t,o.on("SP_LIB_READY",function(){if(l.plugin.streamHandler.lib.hls){var e=[new Promise(function(a){o.on("SP_TEXT_TRACK_UPDATED_LIST",function(e,t){var n=t.subtitleTracks;a(n)})}),new Promise(function(s){o.on("SP_FRAGMENT_AFTER_CHANGE",function(e,t){var n=o.el().getElementsByTagName("video")[0].textTracks,a=document.getElementsByClassName("vjs-icon-captions")[0],i=a.classList.contains("vjs-hidden");0===p.items.length&&!1===i&&a.classList.add("vjs-hidden"),0!==n.length&&0===p.items.length&&s(n)})})];Promise.all(e).then(function(e){var t=[],n=e[0],a=Array.from(e[1]),i=n.concat(a);l.plugin.streamHandler.setTextTrackDisplay(!0),l.plugin.streamHandler.setCurrentTextTrack(-1),l.plugin.streamHandler.setTextTrackDisplay(!1);for(var s=function(a){if("SUBTITLES"===i[a].type){if(!0===i[a].forced)return"continue";t.push({classes:"sp-menu-item",label:i[a].label||i[a].name,id:""+a,order:i.length-a,isActive:!1,selectable:!0,data:i,callback:function(e,t){if(t.isSelected_)return l.plugin.streamHandler.setCurrentTextTrack(-1),p.setActiveItem(),void l.plugin.streamHandler.setTextTrackDisplay(!1);for(var n=0;n<i.length;n+=1)"undefined"!==i[n].mode&&(i[n].mode="disabled");l.plugin.streamHandler.setTextTrackDisplay(!0),l.plugin.streamHandler.setCurrentTextTrack(a),p.setActiveItem(t),o.trigger("hlsSubtitleTrackUpdated",e[a])}})}else if("captions"===i[a].kind){var e=i.length-a;"es"===i[a].language&&(e=-1),t.push({classes:"sp-menu-item",label:i[a].name||i[a].label,id:""+a,order:e,isActive:!1,selectable:!0,data:i,callback:function(e,t){if(t.isSelected_)return i[a].mode="disabled",void p.setActiveItem();0===a&&1<i.length?i[1].mode="disabled":1<i.length&&(i[0].mode="disabled"),i[a].mode="showing",l.plugin.streamHandler.setCurrentTextTrack(-1),l.plugin.streamHandler.setTextTrackDisplay(!1),p.setActiveItem(t),o.trigger("hlsCaptionsUpdated",e[a])}})}else if("metadata"===i[a].kind)return"continue"},r=0;r<i.length;r+=1)s(r);p.addItems(t)})}}),function(){var e=[];if(l.captions){for(var t=0;t<l.captions.length;t++){var n=l.captions[t];if(r){var a={kind:"captions",label:u(n.label),srclang:n.label.toLowerCase(),src:n.file};o.addRemoteTextTrack(a,!0)}e.push({classes:"sp-menu-item",label:u(n.label),selectable:!0,isActive:!1,data:n,callback:function(e,t){if(t.isSelected_)return p.setActiveItem(),void m(!1);p.setActiveItem(t),m(e),o.trigger("remoteTrackUpdated",e)}})}p.addItems(e)}}()}),o.textTracks().addEventListener("addtrack",function(e){t=e.track,setTimeout(function(){t.showing=!0},2e3),t.addEventListener("cuechange",f)}),a}});sardius.menu("closed-captions",closedCaptions);