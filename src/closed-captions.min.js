"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Component=videojs.getComponent("Component"),closedCaptions=videojs.extend(Component,{constructor:function(o,e){var r,t,s,i=new sardius.libs.MenuMaker(o,{anOption:e});i.addClass("vjs-icon-captions");var n=navigator.userAgent,a=-1!==navigator.userAgent.indexOf("iPad"),l=-1!==n.indexOf("Safari")&&-1===n.indexOf("Chrome"),d=l&&(-1!==n.indexOf("iPhone")||-1!==n.indexOf("iPod")),c=d||l&&a;l=l&&d;var u=function(e){var t=r.options.labels,s=e.toLowerCase().replace(/[^a-z0-9]+/gi,"");return void 0!==t[s]&&(e=t[s]),e},p=i.addGroup({classes:"sp-captions",id:"sp-captions",title:"Closed Captions",minItems:1});c&&void 0!==o.playerManager.plugin.options.asset.assets.stream&&i.el_.classList.add("sp-captions-ios-live");var m=function(e){l||(s||((s=document.createElement("div")).className="sp-captions-display",s.innerHTML="",o.el_.appendChild(s)),t&&t.removeEventListener("cuechange",v,!0),e||!s?o.addRemoteTextTrack({kind:"captions",label:u(e.label),srclang:e.label.toLowerCase(),src:e.file,mode:"showing"},!0):s.innerHTML="")};function v(){if(!l&&(void 0!==s&&(s.innerHTML=""),0<this.activeCues_.length)){text=this.activeCues_[0].text,text=text.split(/\n/),o.textTrackDisplay.hide();var e=document.createElement("div");e.className="sp-captions-display-line",e.innerHTML="<div class='sp-captions-display-line-text'> "+text.join("<br />")+" </div>",s.appendChild(e)}}return o.on("settingsMenu-SourceHandler-change",function(e,t){i.hide(),r=t,o.on("SP_HLS_READY",function(){if(r.plugin.sardiusHLS.hls){var e=[new Promise(function(i){r.plugin.sardiusHLS.hls.on(Hls.Events.SUBTITLE_TRACKS_UPDATED,function(e,t){var s=t.subtitleTracks;i(s)})}),new Promise(function(a){r.plugin.sardiusHLS.hls.on(Hls.Events.FRAG_CHANGED,function(e,t){var s=o.el().getElementsByTagName("video")[0].textTracks,i=document.getElementsByClassName("vjs-icon-captions")[0],n=i.classList.contains("vjs-hidden");0===p.items.length&&!1===n&&i.classList.add("vjs-hidden"),0!==s.length&&0===p.items.length&&a(s)})})];Promise.all(e).then(function(e){var t=[],s=e[0],i=Array.from(e[1]),n=s.concat(i);r.plugin.sardiusHLS.hls.subtitleDisplay=!0,r.plugin.sardiusHLS.hls.subtitleTrack=-1,r.plugin.sardiusHLS.hls.subtitleDisplay=!1;for(var a=function(i){if("SUBTITLES"===n[i].type){if(!0===n[i].forced)return"continue";t.push({classes:"sp-menu-item",label:n[i].label||n[i].name,id:""+i,order:n.length-i,isActive:!1,selectable:!0,data:n,callback:function(e,t){if(t.isSelected_)return r.plugin.sardiusHLS.hls.subtitleTrack=-1,p.setActiveItem(),void(r.plugin.sardiusHLS.hls.subtitleDisplay=!1);for(var s=0;s<n.length;s+=1)"undefined"!==n[s].mode&&(n[s].mode="disabled");r.plugin.sardiusHLS.hls.subtitleDisplay=!0,r.plugin.sardiusHLS.hls.subtitleTrack=i,p.setActiveItem(t),o.trigger("hlsSubtitleTrackUpdated",e[i])}})}else if("captions"===n[i].kind){var e=n.length-i;"es"===n[i].language&&(e=-1),t.push({classes:"sp-menu-item",label:n[i].name||n[i].label,id:""+i,order:e,isActive:!1,selectable:!0,data:n,callback:function(e,t){if(t.isSelected_)return n[i].mode="disabled",void p.setActiveItem();0===i&&1<n.length?n[1].mode="disabled":1<n.length&&(n[0].mode="disabled"),n[i].mode="showing",r.plugin.sardiusHLS.hls.subtitleTrack=-1,r.plugin.sardiusHLS.hls.subtitleDisplay=!1,p.setActiveItem(t),o.trigger("hlsCaptionsUpdated",e[i])}})}else if("metadata"===n[i].kind)return"continue"},l=0;l<n.length;l+=1)a(l);p.addItems(t)})}}),function(){var e=[];if(r.captions){for(var t=0;t<r.captions.length;t++){var s=r.captions[t];if(l){var i={kind:"captions",label:u(s.label),srclang:s.label.toLowerCase(),src:s.file};o.addRemoteTextTrack(i,!0)}e.push({classes:"sp-menu-item",label:u(s.label),selectable:!0,isActive:!1,data:s,callback:function(e,t){if(t.isSelected_)return p.setActiveItem(),void m(!1);p.setActiveItem(t),m(e),o.trigger("remoteTrackUpdated",e)}})}p.addItems(e)}}()}),o.textTracks().addEventListener("addtrack",function(e){t=e.track,setTimeout(function(){t.showing=!0},2e3),t.addEventListener("cuechange",v)}),i}});sardius.menu("closed-captions",closedCaptions);