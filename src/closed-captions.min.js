"use strict";sardius.menu("closed-captions",function(l,e){var n,t,i,s=new sardius.libs.MenuMaker(l,{anOption:e});s.addClass("vjs-icon-captions");var a=navigator.userAgent,c=-1!==a.indexOf("Safari")&&-1===a.indexOf("Chrome"),d=c&&(-1!==a.indexOf("iPhone")||-1!==a.indexOf("iPod"));c=c&&d;var r=function(e){var t=n.options.labels,i=e.toLowerCase().replace(/[^a-z0-9]+/gi,"");return void 0!==t[i]&&(e=t[i]),e},o=s.newGroup({classes:"sp-menu",id:"sp-bitrate",title:"Closed Captions",minItems:1}),u=function(e){c||(i||((i=document.createElement("div")).className="sp-captions-display",i.innerHTML="",l.el_.appendChild(i)),t&&t.removeEventListener("cuechange",v,!0),e||!i?l.addRemoteTextTrack({kind:"captions",label:r(e.label),srclang:e.label.toLowerCase(),src:e.file,mode:"showing"},!0):i.innerHTML="")};function v(){if(!c&&(void 0!==i&&(i.innerHTML=""),0<this.activeCues_.length)){text=this.activeCues_[0].text,text=text.split(/\n/),l.textTrackDisplay.hide();var e=document.createElement("div");e.className="sp-captions-display-line",e.innerHTML="<div class='sp-captions-display-line-text'> "+text.join("<br />")+" </div>",i.appendChild(e)}}return l.on("settingsMenu-SourceHandler-change",function(e,t){(n=t).plugin.sardiusHLS.hls&&new Promise(function(a){n.plugin.sardiusHLS.hls.on(Hls.Events.FRAG_CHANGED,function(e,t){var i=l.el().getElementsByTagName("video")[0].textTracks,s=document.getElementsByClassName("vjs-icon-captions")[0],n=s.classList.contains("vjs-hidden");0===o.items.length&&!1===n&&s.classList.add("vjs-hidden"),0!==i.length&&0===o.items.length?a(i):0===i.length&&!1===n&&s.classList.add("vjs-hidden")})}).then(function(s){for(var t=[],e=function(i){var e=s.length-i;"es"===s[i].language&&(e=-1),t.push({classes:"sp-bitrate-auto",label:s[i].name||s[i].label,id:""+i,order:e,isActive:!1,data:s,callback:function(e,t){if(t.isActive)return s[i].mode="disabled",void o.setActiveItem();0===i&&1<s.length?s[1].mode="disabled":1<s.length&&(s[0].mode="disabled"),s[i].mode="showing",o.setActiveItem(t),l.trigger("embeddedCaptionSwitched",e)}})},i=0;i<s.length;i+=1)e(i);o.addItems(t)}).catch(function(e){throw e}),n.plugin.sardiusHLS.hls&&new Promise(function(s){n.plugin.sardiusHLS.hls.on(Hls.Events.SUBTITLE_TRACKS_UPDATED,function(e,t){var i=t.subtitleTracks;s(i)})}).then(function(t){for(var s=[],e=function(i){var e=!1;!0===t[i].default&&(e=n.plugin.sardiusHLS.hls.subtitleDisplay=!0),s.push({classes:"sp-bitrate-auto",label:t[i].name,id:""+i,order:i,isActive:e,data:t[i],callback:function(e,t){if(t.isActive)return n.plugin.sardiusHLS.hls.subtitleTrack=-1,o.setActiveItem(),void(n.plugin.sardiusHLS.hls.subtitleDisplay=!1);o.setActiveItem(t),n.plugin.sardiusHLS.hls.subtitleDisplay=!0,n.plugin.sardiusHLS.hls.subtitleTrack=i,l.trigger("audioTrackSwitched",e)}})},i=0;i<t.length;i+=1)e(i);o.addItems(s)}),function(){var e=[];if(n.captions){for(var t=0;t<n.captions.length;t++){var i=n.captions[t];if(c){var s={kind:"captions",label:r(i.label),srclang:i.label.toLowerCase(),src:i.file};l.addRemoteTextTrack(s,!0)}e.push({classes:"sp-bitrate-auto",label:r(i.label),isActive:!1,data:i,callback:function(e,t){if(t.isActive)return o.setActiveItem(),void u(!1);o.setActiveItem(t),u(e)}})}o.addItems(e)}}()}),l.textTracks().addEventListener("addtrack",function(e){t=e.track,setTimeout(function(){t.showing=!0},2e3),t.addEventListener("cuechange",v)}),s});