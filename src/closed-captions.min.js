"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};sardius.menu("closed-captions",function(r,e){var o,t,i,s=new sardius.libs.MenuMaker(r,{anOption:e});s.addClass("vjs-icon-captions");var n=navigator.userAgent,a=-1!==n.indexOf("Safari")&&-1===n.indexOf("Chrome"),l=a&&(-1!==n.indexOf("iPhone")||-1!==n.indexOf("iPod"));a=a&&l;var c=function(e){var t=o.options.labels,i=e.toLowerCase().replace(/[^a-z0-9]+/gi,"");return void 0!==t[i]&&(e=t[i]),e},d=s.newGroup({classes:"sp-menu",id:"sp-bitrate",title:"Closed Captions",minItems:1}),u=function(e){a||(i||((i=document.createElement("div")).className="sp-captions-display",i.innerHTML="",r.el_.appendChild(i)),t&&t.removeEventListener("cuechange",p,!0),e||!i?r.addRemoteTextTrack({kind:"captions",label:c(e.label),srclang:e.label.toLowerCase(),src:e.file,mode:"showing"},!0):i.innerHTML="")};function p(){if(!a&&(void 0!==i&&(i.innerHTML=""),0<this.activeCues_.length)){text=this.activeCues_[0].text,text=text.split(/\n/),r.textTrackDisplay.hide();var e=document.createElement("div");e.className="sp-captions-display-line",e.innerHTML="<div class='sp-captions-display-line-text'> "+text.join("<br />")+" </div>",i.appendChild(e)}}return r.on("settingsMenu-SourceHandler-change",function(e,t){o=t,function(){if(o.plugin.sardiusHLS.hls){var e=[new Promise(function(s){o.plugin.sardiusHLS.hls.on(Hls.Events.SUBTITLE_TRACKS_UPDATED,function(e,t){var i=t.subtitleTracks;s(i)})}),new Promise(function(a){o.plugin.sardiusHLS.hls.on(Hls.Events.FRAG_CHANGED,function(e,t){var i=r.el().getElementsByTagName("video")[0].textTracks,s=document.getElementsByClassName("vjs-icon-captions")[0],n=s.classList.contains("vjs-hidden");0===d.items.length&&!1===n&&s.classList.add("vjs-hidden"),0!==i.length&&0===d.items.length&&a(i)})})];Promise.all(e).then(function(e){var t=[],i=e[0],s=Array.from(e[1]),n=i.concat(s);o.plugin.sardiusHLS.hls.subtitleDisplay=!0,o.plugin.sardiusHLS.hls.subtitleTrack=-1,o.plugin.sardiusHLS.hls.subtitleDisplay=!1;for(var a=function(s){if("SUBTITLES"===n[s].type){if(!0===n[s].forced)return"continue";t.push({classes:"sp-bitrate-auto",label:n[s].label||n[s].name,id:""+s,order:n.length-s,isActive:!1,data:n,callback:function(e,t){if(t.isActive)return o.plugin.sardiusHLS.hls.subtitleTrack=-1,d.setActiveItem(),void(o.plugin.sardiusHLS.hls.subtitleDisplay=!1);for(var i=0;i<n.length;i+=1)"undefined"!==n[i].mode&&(n[i].mode="disabled");o.plugin.sardiusHLS.hls.subtitleDisplay=!0,o.plugin.sardiusHLS.hls.subtitleTrack=s,d.setActiveItem(t),r.trigger("hlsSubtitleTrackUpdated",e[s])}})}else if("captions"===n[s].kind){var e=n.length-s;"es"===n[s].language&&(e=-1),t.push({classes:"sp-bitrate-auto",label:n[s].name||n[s].label,id:""+s,order:e,isActive:!1,data:n,callback:function(e,t){if(t.isActive)return n[s].mode="disabled",void d.setActiveItem();0===s&&1<n.length?n[1].mode="disabled":1<n.length&&(n[0].mode="disabled"),n[s].mode="showing",o.plugin.sardiusHLS.hls.subtitleTrack=-1,o.plugin.sardiusHLS.hls.subtitleDisplay=!1,d.setActiveItem(t),r.trigger("hlsCaptionsUpdated",e[s])}})}else if("metadata"===n[s].kind)return"continue"},l=0;l<n.length;l+=1)a(l);d.addItems(t)})}}(),function(){var e=[];if(o.captions){for(var t=0;t<o.captions.length;t++){var i=o.captions[t];if(a){var s={kind:"captions",label:c(i.label),srclang:i.label.toLowerCase(),src:i.file};r.addRemoteTextTrack(s,!0)}e.push({classes:"sp-bitrate-auto",label:c(i.label),isActive:!1,data:i,callback:function(e,t){if(t.isActive)return d.setActiveItem(),void u(!1);d.setActiveItem(t),u(e),r.trigger("remoteTrackUpdated",e)}})}d.addItems(e)}}()}),r.textTracks().addEventListener("addtrack",function(e){t=e.track,setTimeout(function(){t.showing=!0},2e3),t.addEventListener("cuechange",p)}),s});